machine:
  pre:
    - curl -o go.tar.gz -sL https://golang.org/dl/go1.6.linux-amd64.tar.gz
    - sudo rm -rf /usr/local/go
    - sudo tar -C /usr/local -xzf go.tar.gz
    - sudo chmod a+w /usr/local/go/src/

dependencies:
  post:
    - go get golang.org/x/tools/cmd/cover
    - go get github.com/modocache/gover
    # codeclimate-test-reporter sends test cover profiles aggregated by gover to codeclimate:
    # It relies on securely encrypted token in env variable CODECLIMATE_REPO_TOKEN
    # - npm install codeclimate-test-reporter

test:
  pre:
    - go version
  override:
    - go vet -x  $(go list ./... | grep -v /vendor/)
    - go test -race --coverprofile=mqtt.coverprofile ./mqtt
    - go test -race --coverprofile=packet.coverprofile ./mqtt/packet
#        timeout: 600